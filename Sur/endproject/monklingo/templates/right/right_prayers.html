<aside class="w-80 bg-white fixed top-0 right-10 h-full mt-10 p-4">
    <!-- ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
    <div class="flex items-center space-x-4 mb-6">
        <div class="w-12 h-12 rounded-full overflow-hidden border border-gray-300 flex-shrink-0">
            {% if request.user.profile_picture %}
            <img src="{{ request.user.profile_picture.url }}" alt="Profile Picture" class="w-full h-full object-cover">
            {% else %}
            <div class="w-full h-full flex items-center justify-center bg-gray-200">
                <i class="text-gray-600 text-lg">üë§</i>
            </div>
            {% endif %}
        </div>
        <span class="text-xl font-bold text-gray-900">
            {{ request.user.username }}
        </span>
    </div>

    <!-- ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
    <div class="bg-yellow-100 rounded-lg p-4 mb-6 relative border">
        <div class="flex justify-between items-center mb-2">
            <h3 class="text-lg font-bold">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</h3>
            <a href='/ranking' class="text-gray-500 hover:underline">‡∏î‡∏π</a>
        </div>
        {% if user_rank and user_rank != "N/A" and user_rank != "None" %}
            <p class="text-gray-700">‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö #{{ user_rank }}</p>
        {% else %}
            <p class="text-gray-700">‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</p>
        {% endif %}
        <p class="text-sm text-gray-600">‡∏ï‡∏±‡∏Å‡∏ö‡∏≤‡∏ï‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...</p>
    </div>

    <!-- ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î -->
    <div class="bg-yellow-100 rounded-lg p-4 relative">
        <div class="flex justify-between items-center mb-2">
            <h3 class="text-lg font-bold">‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h3>
            <a href="/news" class="text-gray-500 text-sm hover:underline">‡∏î‡∏π</a>
        </div>
        {% if latest_news %}
        <p class="text-gray-700 font-semibold truncate w-64" title="{{ latest_news.title }}">
            {{ latest_news.heading|truncatechars:50 }}
        </p>
        <p class="text-sm text-gray-600 truncate w-64" title="{{ latest_news.content }}">
            {{ latest_news.content|truncatechars:100 }}
        </p>
        {% else %}
        <p class="text-gray-700">‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏≠‡∏∞‡πÑ‡∏£...</p>
        {% endif %}
    </div>

    {% if request.user.is_superuser or request.user.is_staff %}
    <div class="bg-yellow-500 rounded-lg text-white text-center py-3 cursor-pointer mt-6 hover:bg-yellow-600"
        onclick="openPostPopup()">
        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏™‡∏ß‡∏î
    </div>
    {% endif %}
</aside>

<!-- ‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå -->
<div id="postPopup" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center">
<div class="bg-white p-6 rounded-lg shadow-lg w-96">
   <h2 class="text-2xl font-bold mb-4">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ö‡∏ó‡∏™‡∏ß‡∏î</h2>
   <form id="createPostForm" enctype="multipart/form-data">
        {% csrf_token %}
       <div class="mb-4">
           <label for="heading" class="block text-gray-700 font-bold mb-2">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ö‡∏ó‡∏™‡∏ß‡∏î</label>
           <input type="text" id="heading" name="heading" class="w-full border-gray-300 rounded-md p-2 border" required>
       </div>
       <div class="mb-4">
           <label for="content" class="block text-gray-700 font-bold mb-2">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ö‡∏ó‡∏™‡∏ß‡∏î</label>
           <textarea id="content" name="content" rows="4" class="w-full border-gray-300 rounded-md p-2 border" required></textarea>
       </div>
       <div class="mb-4">
           <label for="url" class="block text-gray-700 font-bold mb-2">‡∏•‡∏¥‡∏á‡∏Å‡πå</label>
           <input type="url" id="url" name="url" class="w-full border-gray-300 rounded-md p-2 border">
       </div>
       <div class="flex justify-end">
           <button type="button" onclick="closePostPopup()" class="bg-gray-400 text-white py-2 px-4 rounded-lg hover:bg-gray-500 mr-2">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
           <button type="submit" class="bg-yellow-500 text-white py-2 px-4 rounded-lg hover:bg-yellow-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
       </div>
   </form>
</div>
</div>

<script>
// ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏õ
function openPostPopup() {
   document.getElementById("postPopup").classList.remove("hidden");
}

// ‡∏õ‡∏¥‡∏î‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏õ
function closePostPopup() {
   document.getElementById("postPopup").classList.add("hidden");
}

document.getElementById("createPostForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const formData = new FormData(this);

    fetch("{% url 'create_prayers_post' %}", {
        method: "POST",
        body: formData,
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            alert(data.message);
            window.location.href = data.redirect_url; // ‡πÉ‡∏ä‡πâ URL ‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠ Redirect
        } else if (data.error) {
            alert(data.error);
        }
    })
    .catch(error => {
        console.error("Error:", error);
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
    });
});


// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á CSRF token ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>

