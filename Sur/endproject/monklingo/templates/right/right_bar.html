<style>
#uploadModal {
    z-index: 1000; /* ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
    position: fixed; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô */
}
</style>
<div id="alertContainer" class="fixed top-4 left-1/2 transform -translate-x-1/2 hidden z-50">
    <div id="alertMessage" class="p-4 rounded shadow-lg text-white"></div>
</div>
<aside class="w-80 bg-white  fixed top-0 right-10 h-full mt-10 p-4">
    <div class="flex justify-between items-center mb-6">
        <span class="flex items-center text-xl font-bold">
            üèÜ <span class="ml-2">5</span>
        </span>
        <span class="flex items-center text-xl font-bold">
            üî• <span class="ml-2">15 ‡∏ß‡∏±‡∏ô</span>
        </span>
    </div>

    <div class="bg-yellow-100 rounded-lg p-4 mb-6">
        <h3 class="text-lg font-bold mb-2">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</h3>
        <p class="text-gray-700">‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö #5</p>
        <p class="text-sm text-gray-600">‡∏ï‡∏±‡∏Å‡∏ö‡∏≤‡∏ï‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...</p>
    </div>

    <div class="bg-yellow-100 rounded-lg p-4">
        <h3 class="text-lg font-bold mb-2">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
        <p class="text-gray-700">‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏≠‡∏∞‡πÑ‡∏£...</p>
    </div>

  
   <button id="openModal" class="w-64 bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 mt-10 ml-5">
    ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏Å‡∏ö‡∏≤‡∏ï‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
</button>

<!-- ‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏û‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ -->
<div id="uploadModal" class="hidden fixed inset-1  justify-items-end ">
    <div class="bg-gray-100 p-6 rounded-lg shadow-lg w-96 border ">
        <h3 class="text-xl font-bold mb-4">‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏Å‡∏ö‡∏≤‡∏ï‡∏£</h3>

        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á -->
        <video id="video" autoplay class="w-full h-64 bg-gray-300 rounded-lg mb-4"></video>
        <canvas id="canvas" class="hidden"></canvas>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° -->
        <div class="flex justify-between">
            <button id="takePhoto" class="bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600">
                ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ
            </button>
            <button id="closeModal" class="bg-gray-300 text-black py-2 px-4 rounded-lg">
                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            </button>
        </div>

        <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î -->
        <form action="{% url 'upload_image' %}" method="POST" enctype="multipart/form-data" class="mt-4 hidden" id="uploadForm">
            {% csrf_token %}
            <input type="hidden" name="image" id="imageData">
            <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 w-full">
                ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ
            </button>
        </form>
    </div>
</div>

<script>
    const openModal = document.getElementById('openModal');
    const closeModal = document.getElementById('closeModal');
    const uploadModal = document.getElementById('uploadModal');
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const takePhoto = document.getElementById('takePhoto');
    const uploadForm = document.getElementById('uploadForm');
    const imageDataInput = document.getElementById('imageData');
    const alertContainer = document.getElementById('alertContainer');
    const alertMessage = document.getElementById('alertMessage');

    // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
    openModal.addEventListener('click', async () => {
        uploadModal.classList.remove('hidden');
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
        } catch (err) {
            alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ');
            console.error('Error accessing camera:', err);
        }
    });

    // ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
    closeModal.addEventListener('click', () => {
        uploadModal.classList.add('hidden');
        const stream = video.srcObject;
        if (stream) {
            const tracks = stream.getTracks();
            tracks.forEach(track => track.stop());
            video.srcObject = null;
        }
    });

    // ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ
    takePhoto.addEventListener('click', () => {
        const context = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        context.drawImage(video, 0, 0, canvas.width, canvas.height);

        // ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏õ‡πá‡∏ô Base64
        const imageData = canvas.toDataURL('image/png');
        imageDataInput.value = imageData;

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î
        uploadForm.classList.remove('hidden');
        showAlert('‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏î‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'success');
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
    function showAlert(message, type = 'success') {
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        alertMessage.textContent = message;

        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        if (type === 'success') {
            alertMessage.className = 'bg-green-500 p-4 rounded shadow-lg text-white';
        } else if (type === 'error') {
            alertMessage.className = 'bg-red-500 p-4 rounded shadow-lg text-white';
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        alertContainer.classList.remove('hidden');

        // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        setTimeout(() => {
            alertContainer.classList.add('hidden');
        }, 3000);
    }

    // ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ú‡πà‡∏≤‡∏ô AJAX
    uploadForm.addEventListener('submit', async (e) => {
    e.preventDefault(); // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£ Refresh ‡∏´‡∏ô‡πâ‡∏≤
    const formData = new FormData(uploadForm);

    try {
        const response = await fetch("{% url 'upload_image' %}", {
            method: "POST",
            body: formData,
            headers: {
                'X-CSRFToken': "{{ csrf_token }}"
            }
        });

        if (!response.ok) {
            const errorResult = await response.json();
            showAlert(errorResult.message || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", 'error');
            return;
        }

        const result = await response.json();
        if (result.status === "success") {
            showAlert(result.message, 'success'); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            uploadModal.classList.add('hidden'); // ‡∏õ‡∏¥‡∏î‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏û
            const stream = video.srcObject; // ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏û
            if (stream) {
                const tracks = stream.getTracks();
                tracks.forEach(track => track.stop());
                video.srcObject = null;
            }
            disableUploadButton(); // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        } else {
            showAlert(result.message, 'error'); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
        }
    } catch (error) {
        showAlert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ", 'error');
        console.error("Error uploading image:", error);
    }
});

// ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏î‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
function disableUploadButton() {
    openModal.disabled = true; // ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î
    openModal.classList.add('opacity-50', 'cursor-not-allowed'); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
    showAlert("‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á", "info");
}
</script>